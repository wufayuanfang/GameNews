{% load staticfiles %}
<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>XX游戏资讯</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    {% load static %}
    <link rel="stylesheet" type="text/css"
          href="{% static 'users/css_js/main.css' %}">
    <style data-emotion="css"></style>
</head>
<style>
    input[type=date]::-webkit-inner-spin-button {
        visibility: hidden;
    }
</style>
<body>
<div>
    <div class="gnav_container gnav_container-twoRow">
        <nav class="gnav gnav-logoCenter">
            <div class="container">
                <div class="gnav_menuBtns"><a class="gnav_menuBtn gnav_item" role="button" tabindex="0"
                                              target="_blank">
                    <svg aria-hidden="true" focusable="false" data-prefix="gfas" data-icon="bars"
                         class="svg-inline--fa fa-sm" role="img" xmlns="http://www.w3.org/2000/svg"
                         viewBox="0 0 9 8">
                        <path fill="currentColor"
                              d="M1.26666667,0.65 L8.06666667,0.65 C8.39803752,0.65 8.66666667,0.91862915 8.66666667,1.25 C8.66666667,1.58137085 8.39803752,1.85 8.06666667,1.85 L1.26666667,1.85 C0.935295817,1.85 0.666666667,1.58137085 0.666666667,1.25 C0.666666667,0.91862915 0.935295817,0.65 1.26666667,0.65 Z M1.26666667,3.65 L8.06666667,3.65 C8.39803752,3.65 8.66666667,3.91862915 8.66666667,4.25 C8.66666667,4.58137085 8.39803752,4.85 8.06666667,4.85 L1.26666667,4.85 C0.935295817,4.85 0.666666667,4.58137085 0.666666667,4.25 C0.666666667,3.91862915 0.935295817,3.65 1.26666667,3.65 Z M1.26666667,6.65 L8.06666667,6.65 C8.39803752,6.65 8.66666667,6.91862915 8.66666667,7.25 C8.66666667,7.58137085 8.39803752,7.85 8.06666667,7.85 L1.26666667,7.85 C0.935295817,7.85 0.666666667,7.58137085 0.666666667,7.25 C0.666666667,6.91862915 0.935295817,6.65 1.26666667,6.65 Z"></path>
                    </svg>
                </a></div>
                <div class="gnav_body">
                    <div class="gnav_logo">
                        <div class="gnav_logo_icon"></div>
                    </div>
                    <div class="gnav_contentItems"><a class="gnav_item" href="{% url 'index' %}">首页</a><a
                            class="gnav_item"
                            href="{% url 'discount_all' %}">游戏</a><a
                            class="gnav_item" href="{% url 'news' %}">资讯</a><a
                            class="gnav_item" href="{% url 'video' %}">视频</a><a
                            class="gnav_item" href="{% url 'music' %}">音乐</a>
                    </div>
                </div>
                <div class="gnav_alwaysBtns"><a class="gnav_menuBtn gnav_item" role="button" tabindex="0"
                                                target="_blank">
                    <svg aria-hidden="true" focusable="false" data-prefix="gfas" data-icon="search"
                         class="svg-inline--fa" role="img" xmlns="http://www.w3.org/2000/svg"
                         viewBox="0 0 11 11">
                        <path fill="currentColor"
                              d="M7.97229897,7.23067439 L10.3141294,9.57250481 C10.5419352,9.80031064 10.5419352,10.1696569 10.3141294,10.3974627 C10.0863235,10.6252686 9.71697731,10.6252686 9.48917147,10.3974627 L7.07954816,7.9878394 C6.40679319,8.41758833 5.60747456,8.66666667 4.75,8.66666667 C2.3568339,8.66666667 0.416666667,6.72649944 0.416666667,4.33333333 C0.416666667,1.94016723 2.3568339,1.00364161e-13 4.75,1.00364161e-13 C7.1431661,1.00364161e-13 9.08333333,1.94016723 9.08333333,4.33333333 C9.08333333,5.44724359 8.66299995,6.46301255 7.97229897,7.23067439 Z M7.91666667,4.33333333 C7.91666667,2.58449944 6.4988339,1.16666667 4.75,1.16666667 C3.0011661,1.16666667 1.58333333,2.58449944 1.58333333,4.33333333 C1.58333333,6.08216723 3.0011661,7.5 4.75,7.5 C6.4988339,7.5 7.91666667,6.08216723 7.91666667,4.33333333 Z"></path>
                    </svg>
                </a></div>
            </div>
        </nav>
    </div>
    <div class="settingsPage pageContainer">
        <div class="container">
            <div class="ah_section"><h2 class="ah_title"><span>设置</span></h2>
                <div class="settingsPage_layout">
                    <div class="settingsPage_index">
                        <div>
                            <div style="padding-bottom: 0px;"></div>
                            <div style="top: 60px; transform: translateZ(0px);">
                                {% include 'users/tab_info.html' %}
                            </div>
                        </div>
                    </div>
                    <div class="settingsPage_body">
                        <div class="settingsPage_box" id="nopop_profile">
                            <div class="settingsPage_box" id="nopop_profile">
                                <div class="settingsPage_box_header">修改资料</div>
                                <div class="settingsPage_box_body">
                                    <form method="POST" action="." id="info_form">
                                        {% csrf_token %}
                                        <div class="form-group row"><label
                                                class="col-form-label col-sm-2">Username</label>
                                            <div class="col-sm-10"><input name="username"
                                                                          placeholder="Username"
                                                                          class="form-control"
                                                                          disabled=""
                                                                          type="text"
                                                                          value="{{ request.user.username }}"/><input
                                                    name="user_id" type="hidden"
                                                    value="{{ request.user.id }}"/>
                                                <div class="ml-1"><small
                                                        class="form-text text-muted">长度：1至30</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group row"><label
                                                class="col-form-label col-sm-2">Password</label>
                                            <div class="col-sm-10"><input name="password"
                                                                          placeholder="Password"
                                                                          class="form-control"
                                                                          type="password"
                                                                          value="{{ request.user.password }}"/>
                                                <div class="ml-1"><small
                                                        class="form-text text-muted">密码是加密的！修改后会自动加密！</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group row"><label
                                                class="col-form-label col-sm-2">Email</label>
                                            <div class="col-sm-10"><input name="email" placeholder="email"
                                                                          class="form-control" disabled=""
                                                                          type="text"
                                                                          value="{{ request.user.email }}">
                                                <div class="ml-1"><small
                                                        class="form-text text-muted">(修改Email暂未开放)</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group row"><label
                                                class="col-form-label col-sm-2">操作：</label>
                                            <div class="col-sm-10">
                                                <button class="btn btn-assist btn-ellipse" type="submit"
                                                        style="background: #6ddc67;">确认修改信息
                                                </button>
                                                <a href="{% url 'logout' %}">
                                                    <button class="btn btn-assist btn-ellipse" type="button"
                                                            style="background: #dc556a;">登出
                                                    </button>
                                                </a>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            {% if request.user.is_superuser %}
                                <div class="settingsPage_box" id="nopop_account">
                                    <div class="settingsPage_box_header">爬虫管理</div>
                                    <div class="settingsPage_box_body">
                                        <form method="GET" action="{% url 'spider' %}">
                                            {% csrf_token %}
                                            <div class="form-group row">
                                                <label
                                                        class="col-form-label col-sm-2">爬取目标</label>
                                                <Select name="target" style="margin-right: 20px;">
                                                    <option value="gcore">机核文章</option>
                                                    <option value="gamesky">游民星空文章</option>
                                                    <option value="youxun">游讯网文章</option>
                                                    <option value="lol">英雄联盟视频</option>
                                                    <option value="cf">穿越火线视频</option>
                                                    <option value="hpjy">和平精英视频</option>
                                                    <option value="discount">游戏折扣排行</option>
                                                    <option value="spider_all">全部</option>
                                                </Select>
                                                <input name="spider_date" class="mr-3" type="date"
                                                       max="{{ today }}"
                                                       value="{{ today }}" min="2020-05-01"/>
                                                <button class="btn btn-assist btn-ellipse" type="submit">开始爬取
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <footer class="footer"></footer>
            <div class="globalActions"></div>
            <div></div>
            <div></div>
        </div>
    </div>
</div>
<div>
    <div class="sideDrawer"></div>
</div>
<div>
    <div class="sideDrawer"></div>
</div>
<div class="ReactModalPortal"></div>
<div class="ReactModalPortal"></div>
<div class="ReactModalPortal"></div>
<div class="ReactModalPortal"></div>
<div class="ReactModalPortal"></div>
</body>
</html>
{% if messages %}
    <script>
        {% for msg in messages %}
            alert('{{ msg.message }}');
        {% endfor %}
    </script>
{% endif %}
<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
<script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
<script src="{% static 'layer/layer.js' %}"></script>

<script type="text/javascript">
    $(document).ready(function () {
        $('#info_form').submit(function () {
            $.ajax({
                type: "POST",
                data: $('#info_form').serialize(),
                url: "{% url 'setting' %}",
                cache: false,
                dataType: "json",
                success: function (data) {
                    if (data['code'] === 200) {
                        layer.open({
                            type: 1
                            , offset: 'auto' //具体配置参考：offset参数项
                            , content: '<div style="padding: 20px 80px;">修改成功,请重新登录！</div>'
                            , btn: '好的'
                            , btnAlign: 'c' //按钮居中
                            , shade: 0 //不显示遮罩
                            , yes: function () {
                                window.location.reload();
                            }
                        });
                    }
                    ;
                    if (data.code === 404) {
                        layer.alert('你没有权限修改此用户的信息')
                    }


                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert("修改失败，" + errorThrown);
                }
            });
            return false;
        });
    });
</script>